{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Outline Schema",
  "description": "Validates the structure of an outline.yml file for Docusaurus sidebars.",
  "type": "object",
  "properties": {
    "sidebars": {
      "description": "The main container for sidebar navigation. An array of top-level sidebar items.",
      "type": "array",
      "items": { "$ref": "#/$defs/topLevelSidebarItem" },
      "minItems": 0
    }
  },
  "required": ["sidebars"],
  "additionalProperties": false,

  "$defs": {
    "id": {
      "description": "A unique identifier, used for URL paths. Must be a URL-friendly slug.",
      "type": "string",
      "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
    },
    "descriptiveMetadata": {
      "type": "object",
      "properties": {
        "description": { "type": "string" },
        "summary": { "type": "string" },
        "brief": { "type": "string" }
      }
    },
    "commonMetadata": {
      "type": "object",
      "allOf": [{ "$ref": "#/$defs/descriptiveMetadata" }],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "tags": {
          "anyOf": [
            { "type": "string", "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$" },
            {
              "type": "array",
              "items": { "type": "string", "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$" },
              "uniqueItems": true
            }
          ]
        }
      }
    },
    "indexPageMetadata": {
      "type": "object",
      "allOf": [{ "$ref": "#/$defs/descriptiveMetadata" }],
      "properties": {
        "title": { "type": "string" },
        "link": { "type": "string", "format": "uri-reference" }
      }
    },
    "autogeneratedCategory": {
      "description": "A Docusaurus autogenerated sidebar category.",
      "type": "object",
      "properties": {
        "label": { "type": "string" },
        "dirName": { "type": "string" },
        "sidebar_position": { "type": "number" }
      },
      "required": ["dirName"],
      "additionalProperties": false
    },

    "pageShorthand": {
      "description": "A simple string representing a page link.",
      "type": "string"
    },

    "pageObject": {
      "description": "A page link represented as an object, optionally with headings.",
      "allOf": [{ "$ref": "#/$defs/descriptiveMetadata" }],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "label": { "type": "string" },
        "headings": {
          "type": "array",
          "items": { "$ref": "#/$defs/headingItem" }
        },
        "slug": { "type": "string" },
        "sidebar_position": { "type": "number" },
        "hide_title": { "type": "boolean" },
        "hide_table_of_contents": { "type": "boolean" },
        "custom_edit_url": { "type": "string", "format": "uri" },
        "keywords": { "type": "array", "items": { "type": "string" }, "uniqueItems": true }
      },
      "required": ["label"],
      "additionalProperties": false
    },

    "categoryShorthand": {
      "description": "A category represented by a single key (the label) and an array of items as the value.",
      "type": "object",
      "maxProperties": 1,
      "minProperties": 1,
      "patternProperties": {
        "^(?!label$|dirName$).*$": {
          "anyOf": [
            {
              "type": "array",
              "items": { "$ref": "#/$defs/sidebarItem" }
            },
            { "$ref": "#/$defs/categoryShorthand" }
          ]
        }
      },
      "additionalProperties": false
    },
    "categoryObject": {
      "description": "A category represented as an object with a label and an items array.",
      "allOf": [{ "$ref": "#/$defs/descriptiveMetadata" }],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "label": { "type": "string" },
        "items": {
          "type": "array",
          "items": { "$ref": "#/$defs/sidebarItem" }
        },
        "index": {
          "description": "Optional: Defines an index page for the category. Can be a boolean or an object.",
          "anyOf": [
            { "type": "boolean" },
            {
              "type": "object",
              "allOf": [{ "$ref": "#/$defs/indexPageMetadata" }]
            }
          ]
        },
        "collapsible": { "type": "boolean" },
        "collapsed": { "type": "boolean" },
        "link": { "type": "string", "format": "uri-reference" }
      },
      "required": ["label"],
      "additionalProperties": false
    },

    "linkItem": {
      "description": "An item that links to an external or internal URL.",
      "allOf": [{ "$ref": "#/$defs/descriptiveMetadata" }],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "label": { "type": "string" },
        "href": { "type": "string", "format": "uri-reference" }
      },
      "required": ["label", "href"],
      "additionalProperties": false
    },

    "headingItem": {
      "description": "An item within a page's headings section.",
      "if": { "type": "string" },
      "then": { "type": "string" },
      "else": {
        "anyOf": [
          {
            "type": "object",
            "properties": {
              "label": { "type": "string" },
              "items": {
                "type": "array",
                "items": { "$ref": "#/$defs/headingItem" }
              }
            },
            "required": ["label"]
          },
          {
            "type": "object",
            "maxProperties": 1,
            "minProperties": 1,
            "patternProperties": {
              "^.*$": {
                "type": "array",
                "items": { "$ref": "#/$defs/headingItem" }
              }
            }
          }
        ]
      }
    },

    "sidebarItem": {
      "description": "A single item in a sidebar or category. Can be a page, a category, a link, or an autogenerated category.",
      "if": { "type": "string" },
      "then": { "$ref": "#/$defs/pageShorthand" },
      "else": {
        "if": {
          "type": "object",
          "maxProperties": 1,
          "minProperties": 1,
          "patternProperties": {
            "^(?!label$|dirName$).*$": {
              "anyOf": [
                { "type": "array" },
                { "type": "object" }
              ]
            }
          },
          "additionalProperties": false
        },
        "then": { "$ref": "#/$defs/categoryShorthand" },
        "else": {
          "anyOf": [
            { "$ref": "#/$defs/pageObject" },
            { "$ref": "#/$defs/categoryObject" },
            { "$ref": "#/$defs/linkItem" },
            { "$ref": "#/$defs/autogeneratedCategory" }
          ]
        }
      }
    },

    "topLevelSidebarItem": {
      "description": "A top-level item in a sidebar. Can be a page shorthand, a category, or an autogenerated category.",
      "if": { "type": "string" },
      "then": { "$ref": "#/$defs/pageShorthand" },
      "else": {
        "if": {
          "type": "object",
          "maxProperties": 1,
          "minProperties": 1,
          "patternProperties": {
            "^.*$": {
              "type": "array"
            }
          }
        },
        "then": { "$ref": "#/$defs/categoryShorthand" },
        "else": {
          "anyOf": [
            { "$ref": "#/$defs/categoryObject" },
            { "$ref": "#/$defs/autogeneratedCategory" }
          ]
        }
      }
    }
  }
}
